---
title: "Analysis Script - Bias in AI"
author: "Vorisek_CN"
date: "30 12 2021"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

*Load relevant libraries*
```{r}
library(readxl)
library(tidyverse)
library(writexl)
library(knitr)
library(arsenal)
library(data.table)
library(ggplot2)
library(dplyr)
```

*Bar themes*
```{r}
# define theme and colors for barplots
bar_theme <-   theme(rect = element_blank(),
        axis.ticks.y = element_line(color = "grey40"),
        panel.grid.major.x = element_line(color = "grey90"))
bar_color <-  "#1b3051"
bar_width <- 0.6
```

*Read in file created in "Data_Preparation.Rmd" and "Data Cleaning.Rmd"*
```{r}
analysis <- read_excel("AnalysisFile_Bias_AI.xlsx")
View(analysis)
```


# Demographics

**Prepare Data**
```{r}
analysis$arbeitsland = as.factor(analysis$arbeitsland)
analysis$geschlecht = as.factor(analysis$geschlecht)
analysis$sektor = as.factor(analysis$sektor)
analysis$quelle = as.factor(analysis$quelle)
analysis$alter = as.numeric(analysis$alter)
```


## How did this questionnaire reach you?
```{r}
source <- analysis %>% 
  group_by(quelle) %>% 
  summarize(N = n()) %>% 
  mutate(Percent = N / sum(N) * 100,
         Percent = round(Percent, 1)) %>% 
  arrange(desc(N))

source$quelle <- factor(source$quelle,levels = c(1,2,3,4,5,6), labels = c("Twitter","Linkedin","Email distribution list of my institution", "Personal contact", "Other", "Not specified"))

knitr::kable(source)
```

```{r}
ggplot(source) + geom_col(aes(reorder(quelle, N, sum), N),
                              fill = bar_color,
                              width = bar_width) +
  labs(x = "", y = "Number of Participants", title = "How did this questionnaire reach you?") +
  scale_y_continuous(breaks = seq(0,100,10)) +
  coord_flip() +
  bar_theme
```


## Which country do you work in?
```{r}
country <- analysis %>% 
  group_by(arbeitsland) %>% 
  summarize(N = n()) %>% 
  mutate(Percent = N / sum(N) * 100,
         Percent = round(Percent, 1)) %>% 
  arrange(desc(N))

knitr::kable(country)
```

```{r}
ggplot(country) + geom_col(aes(reorder(arbeitsland, N, sum), N),
                              fill = bar_color,
                              width = bar_width) +
  labs(x = "", y = "Number of Participants", title = "Which country do you work in?") +
  scale_y_continuous(breaks = seq(0,150,25)) +
  coord_flip() +
  bar_theme
```


## What is your gender?
```{r}
gender <- analysis %>% 
  group_by(geschlecht) %>% 
  summarize(N = n()) %>% 
  mutate(Percent = N / sum(N) * 100,
         Percent = round(Percent, 1)) %>% 
  arrange(desc(N))

gender$geschlecht <- factor(gender$geschlecht,levels = c(1,2,3,4,5), labels = c("Female","Male","Diverse", "Undefined", "Not specified"))

knitr::kable(gender)
```

```{r}
ggplot(gender) + geom_col(aes(reorder(geschlecht, N, sum), N),
                              fill = bar_color,
                              width = bar_width) +
  labs(x = "", y = "Number of Participants", title = "What is your gender?") +
  scale_y_continuous(breaks = seq(0,200,25)) +
  coord_flip() +
  bar_theme
```


## What is your age?
*check for normality*
```{r}
hist(analysis$alter)
summary.default(analysis$alter)
```


## In which area do you work in?
```{r}
section <- analysis %>% 
  group_by(sektor) %>% 
  summarize(N = n()) %>% 
  mutate(Percent = N / sum(N) * 100,
         Percent = round(Percent, 1)) %>% 
  arrange(desc(N))

section$sektor <- factor(section$sektor,levels = c(1,2,3,4,5), labels = c("Science","Clinical Work","Industry", "Other", "Not specified"))

knitr::kable(section)
```

```{r}
ggplot(section) + geom_col(aes(reorder(sektor, N, sum), N),
                              fill = bar_color,
                              width = bar_width) +
  labs(x = "", y = "Number of Participants", title = "In which area do you work in?") +
  scale_y_continuous(breaks = seq(0,200,50)) +
  coord_flip() +
  bar_theme
```


## At what stage are you or have you been developing AI-projects?
```{r}
which(colnames(analysis) == "ki_entwicklungsphase___1")
which(colnames(analysis) == "ki_entwicklungsphase___8")
```
*create dataset*
```{r}
kiphase<-analysis %>% select(19:26)

view(kiphase)
```
**Multi-response analysis**
*Pct.of.cases is the percentage of respondents who selected that particular option. You'll notice that these don't add up to 100% because people could choose more than one option.Pct.of.resp. is the percentage of responses (so not like I said in the video respondents, but responses).  These do add up to 100%. *
```{r}
kiphase_analysis <-data.frame(Freq = colSums(kiphase),
           Pct.of.Resp = (colSums(kiphase)/sum(kiphase))*100,
           Pct.of.Cases = (colSums(kiphase)/nrow(kiphase))*100)

rownames(kiphase_analysis) <- c("Project planning","Data acquisition/ data preprocessing","Data annotation","Identification of AI algorithms", "Training and optimization", "Practical testing of AI algorithms", "Other", "Not specified")

knitr::kable(kiphase_analysis)
```
*You can use the las graphics parameter. However, if you do that, the names will run off the end of the window, so you need to change the margins.*
```{r}
barplot(kiphase_analysis[[3]]
        ,horiz=TRUE
        ,names.arg=row.names(kiphase_analysis)
        ,las=1
        ,main="At what stage are you or have you been developing AI-projects?"
        ,xlab="percentage of responses")
```


## In which medical specialty are you developing AI solutions?
```{r}
which(colnames(analysis) == "med_fachbereich___1")
which(colnames(analysis) == "med_fachbereich___37")
```
*create dataset*
```{r}
specialty<-analysis %>% select(28:64)
view(specialty)
```
**Multi-response analysis**
*Pct.of.cases is the percentage of respondents who selected that particular option. You'll notice that these don't add up to 100% because people could choose more than one option.Pct.of.resp. is the percentage of responses (so not like I said in the video respondents, but responses).  These do add up to 100%. *
```{r}
specialty_analysis <-data.frame(Freq = colSums(specialty),
           Pct.of.Resp = (colSums(specialty)/sum(specialty))*100,
           Pct.of.Cases = (colSums(specialty)/nrow(specialty))*100)



knitr::kable(kiphase_analysis)
```
*You can use the las graphics parameter. However, if you do that, the names will run off the end of the window, so you need to change the margins.*
```{r}
barplot(specialty_analysis[[3]]
        ,horiz=TRUE
        ,names.arg=row.names(specialty_analysis)
        ,las=1
        ,main="In which medical specialty are you developing AI solutions?"
        ,xlab="percentage of responses")
```



## In which of the following areas of AI are you developing?
```{r}
which(colnames(analysis) == "ki_art___1")
which(colnames(analysis) == "ki_art___4")
```
*create dataset*
```{r}
areas<-analysis %>% select( 66:69)
view(areas)
```
**Multi-response analysis**
*Pct.of.cases is the percentage of respondents who selected that particular option. You'll notice that these don't add up to 100% because people could choose more than one option.Pct.of.resp. is the percentage of responses (so not like I said in the video respondents, but responses).  These do add up to 100%. *
```{r}
areas_analysis <-data.frame(Freq = colSums(areas),
           Pct.of.Resp = (colSums(areas)/sum(areas))*100,
           Pct.of.Cases = (colSums(areas)/nrow(areas))*100)
```

```{r}
rownames(areas_analysis) <- c("Machine Learning","Deep Learning","Other type of AI", "Not specified")
knitr::kable(areas_analysis)
```
```{r}
barplot(areas_analysis[[3]]
        ,horiz=TRUE
        ,names.arg=row.names(areas_analysis)
        ,las=1
        ,main="In which of the following areas of AI are you developing?"
        ,xlab="percentage of responses")
```



## Please specify the type of Machine Learning (ML) you aredeveloping:

## Please specify the type of Deep Learning you are developing:


## In which of the following areas of AI are you developing?
```{r}
which(colnames(analysis) == "ki_bereich___1")
which(colnames(analysis) == "ki_bereich___7")
```

```{r}
areas_2 <-analysis %>% select(81:87)
view(areas_2)
```

**Multi-response analysis**
*Pct.of.cases is the percentage of respondents who selected that particular option. You'll notice that these don't add up to 100% because people could choose more than one option.Pct.of.resp. is the percentage of responses (so not like I said in the video respondents, but responses).  These do add up to 100%. *
```{r}
areas_2_analysis <-data.frame(Freq = colSums(areas_2),
           Pct.of.Resp = (colSums(areas_2)/sum(areas_2))*100,
           Pct.of.Cases = (colSums(areas_2)/nrow(areas_2))*100)
```

```{r}
rownames(areas_2_analysis) <- c("Natural Language Processing","Clinical Decision Support","Image processing", "Computer vision", "Robotics", "Other", "Not specified")
knitr::kable(areas_2_analysis)
```
```{r}
barplot(areas_2_analysis[[3]]
        ,horiz=TRUE
        ,names.arg=row.names(areas_2_analysis)
        ,las=1
        ,main="In which of the following areas of AI are you developing?"
        ,xlab="percentage of responses")
```

# Main Outcomes
## How familiar are you with biases in AI?
```{r}
familiar <- analysis %>% 
  group_by(bias_ki) %>% 
  summarize(N = n()) %>% 
  mutate(Percent = N / sum(N) * 100,
         Percent = round(Percent, 1)) %>% 
  arrange(desc(N))

familiar$bias_ki <- factor(familiar$bias_ki,levels = c(1,2,3), labels = c("I have never heard of biases in AI","I have heard of biases in AI but I can not think ofconcrete examples","I have heard of biases in AI and I do know specifi cuse cases"))

knitr::kable(familiar)
```

```{r}
ggplot(familiar) + geom_col(aes(reorder(bias_ki, N, sum), N),
                              fill = bar_color,
                              width = bar_width) +
  labs(x = "", y = "Number of Participants", title = "How familiar are you with biases in AI?") +
  scale_y_continuous(breaks = seq(0,200,25)) +
  coord_flip() +
  bar_theme
```


## Where do you think biases in AI can occur?
```{r}
which(colnames(analysis) == "bias_feld___1")
which(colnames(analysis) == "bias_feld___6")
```

```{r}
occur <-analysis %>% select(90:95)
view(occur)
```

**Multi-response analysis**
*Pct.of.cases is the percentage of respondents who selected that particular option. You'll notice that these don't add up to 100% because people could choose more than one option.Pct.of.resp. is the percentage of responses (so not like I said in the video respondents, but responses).  These do add up to 100%. *
```{r}
occur_2_analysis <-data.frame(Freq = colSums(occur),
           Pct.of.Resp = (colSums(occur)/sum(occur))*100,
           Pct.of.Cases = (colSums(occur)/nrow(occur))*100)
```

```{r}
rownames(occur_2_analysis) <- c("Methodology of algorithms","Societal factors","Bias due to data validation or data security", "Not specified", "Other", "None of the above")
knitr::kable(occur_2_analysis)
```
```{r}
barplot(occur_2_analysis[[3]]
        ,horiz=TRUE
        ,names.arg=row.names(occur_2_analysis)
        ,las=1
        ,main="Where do you think biases in AI can occur?"
        ,xlab="percentage of responses")
```



## What data do you use to train AI algorithms?
```{r}
which(colnames(analysis) == "ki_trainingsdaten___1")
which(colnames(analysis) == "ki_trainingsdaten___4")
```

```{r}
train <-analysis %>% select(97:100)
view(train)
```

**Multi-response analysis**
*Pct.of.cases is the percentage of respondents who selected that particular option. You'll notice that these don't add up to 100% because people could choose more than one option.Pct.of.resp. is the percentage of responses (so not like I said in the video respondents, but responses).  These do add up to 100%. *
```{r}
train_2_analysis <-data.frame(Freq = colSums(train),
           Pct.of.Resp = (colSums(train)/sum(train))*100,
           Pct.of.Cases = (colSums(train)/nrow(train))*100)
```

```{r}
rownames(train_2_analysis) <- c("Image data","Audio data","Text data", "Not specified")
knitr::kable(train_2_analysis)
```
```{r}
barplot(train_2_analysis[[3]]
        ,horiz=TRUE
        ,names.arg=row.names(train_2_analysis)
        ,las=1
        ,main="What data do you use to train AI algorithms?"
        ,xlab="percentage of responses")
```



## What is the origin of your data?
```{r}
which(colnames(analysis) == "ki_daten_quelle___1")
which(colnames(analysis) == "ki_daten_quelle___6")
```

```{r}
origin <-analysis %>% select( 101:106)
view(origin)
```

**Multi-response analysis**
*Pct.of.cases is the percentage of respondents who selected that particular option. You'll notice that these don't add up to 100% because people could choose more than one option.Pct.of.resp. is the percentage of responses (so not like I said in the video respondents, but responses).  These do add up to 100%. *
```{r}
origin_2_analysis <-data.frame(Freq = colSums(origin),
           Pct.of.Resp = (colSums(origin)/sum(origin))*100,
           Pct.of.Cases = (colSums(origin)/nrow(origin))*100)
```

```{r}
rownames(origin_2_analysis) <- c("Wearables","Registries","Database from one center", "Multi-center database", "Other", "Not specified")

knitr::kable(origin_2_analysis)
```

```{r}
barplot(origin_2_analysis[[3]]
        ,horiz=TRUE
        ,names.arg=row.names(origin_2_analysis)
        ,las=1
        ,main="What is the origin of your data?"
        ,xlab="percentage of responses")
```

## Do you work with national or international data?
```{r}
national <- analysis %>% 
  group_by(nat_internat_daten) %>% 
  summarize(N = n()) %>% 
  mutate(Percent = N / sum(N) * 100,
         Percent = round(Percent, 1)) %>% 
  arrange(desc(N))

national$nat_internat_daten <- factor(national$nat_internat_daten,levels = c(1,2,3, 4), labels = c("National data","International data","National and international data", "Not specified"))

knitr::kable(national)
```

```{r}
ggplot(national) + geom_col(aes(reorder(nat_internat_daten, N, sum), N),
                              fill = bar_color,
                              width = bar_width) +
  labs(x = "", y = "Number of Participants", title = "Do you work with national or international data?") +
  scale_y_continuous(breaks = seq(0,200,25)) +
  coord_flip() +
  bar_theme
```


## Do you think that using standardized data (internationalsemantic and syntactic standards such as HL7 FHIR, SNOMEDCT) when training AI algorithms can prevent bias?


##Save Code for further Analysis
https://libguides.library.kent.edu/SPSS/Multiple-Response-Sets
https://www.theanalysisfactor.com/r-tutorial-counting-values/